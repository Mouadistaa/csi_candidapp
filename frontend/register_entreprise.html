<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inscription Entreprise - Candidapp</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eef2ff',
              100: '#e0e7ff',
              200: '#c7d2fe',
              300: '#a5b4fc',
              400: '#818cf8',
              500: '#6366f1',
              600: '#4f46e5',
              700: '#4338ca',
              800: '#3730a3',
              900: '#312e81',
            },
          }
        }
      }
    }
  </script>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #a855f7 100%);
    }
  </style>
</head>

<body class="min-h-screen gradient-bg flex flex-col">

  <!-- Header -->
  <header class="p-6">
    <a href="/" class="flex items-center space-x-2 w-fit">
      <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      </div>
      <span class="text-xl font-bold text-white">Candidapp</span>
    </a>
  </header>

  <!-- Register Form -->
  <main class="flex-1 flex items-center justify-center px-4 pb-12">
    <div class="w-full max-w-md">
      <div class="bg-white rounded-2xl shadow-2xl p-8">
        <div class="text-center mb-8">
          <h1 class="text-2xl font-bold text-gray-900 mb-2">Inscription Entreprise</h1>
          <p class="text-gray-600">Créez votre compte entreprise</p>
        </div>

        <div id="error" class="hidden bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg mb-6 text-sm">
        </div>

        <form id="registerForm" class="space-y-5">
          
          <div class="border-b pb-4 mb-4">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Informations Société</h2>
            
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Raison Sociale <span class="text-red-500">*</span></label>
              <div class="relative">
                <input id="raisonSociale" type="text" required placeholder="Ex: TechCorp Solutions"
                  class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" />
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Numéro SIRET <span class="text-red-500">*</span></label>
                <input id="siret" type="text" required placeholder="14 chiffres" pattern="[0-9]{14}" title="14 chiffres requis"
                  class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Site Web</label>
                <input id="siteWeb" type="url" placeholder="https://..."
                  class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" />
              </div>
            </div>
          </div>

          <div class="border-b pb-4 mb-4">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Localisation</h2>
            
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Adresse postale <span class="text-red-500">*</span></label>
              <input id="adresse" type="text" required placeholder="Ex: 12 Rue de l'Innovation"
                class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" />
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ville <span class="text-red-500">*</span></label>
                <input id="ville" type="text" required placeholder="Ex: Lyon"
                  class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Pays <span class="text-red-500">*</span></label>
                <select id="pays" required class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition bg-white">
                  <option value="France" selected>France</option>
                  <option value="Belgique">Belgique</option>
                  <option value="Suisse">Suisse</option>
                  <option value="Luxembourg">Luxembourg</option>
                  <option value="Allemagne">Allemagne</option>
                  <option value="Autre">Autre</option>
                </select>
              </div>
            </div>
          </div>

          <div>
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Compte & Contact</h2>

            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Nom du Contact RH <span class="text-red-500">*</span></label>
              <input id="contactNom" type="text" required placeholder="Ex: Jean Dupont"
                class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" />
            </div>

            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Email de connexion <span class="text-red-500">*</span></label>
              <input id="email" type="email" required placeholder="rh@entreprise.com"
                class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" />
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe <span class="text-red-500">*</span></label>
                <input id="password" type="password" required placeholder="••••••••" minlength="6"
                  class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Confirmation <span class="text-red-500">*</span></label>
                <input id="passwordConfirm" type="password" required placeholder="••••••••"
                  class="block w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" />
              </div>
            </div>
          </div>

          <button type="submit" id="submitBtn"
            class="w-full mt-6 py-3 px-4 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition transform hover:-translate-y-0.5">
            Finaliser l'inscription
          </button>
        </form>

        <div class="mt-8 text-center">
          <p class="text-gray-600 text-sm">
            Déjà un compte ?
            <a href="/login" class="text-primary-600 hover:text-primary-700 font-semibold">Se connecter</a>
          </p>
        </div>
      </div>

      <p class="text-center text-white/70 text-sm mt-6">
        <a href="/" class="hover:text-white transition">← Retour à l'accueil</a>
      </p>
    </div>
  </main>

  <script>
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const errorEl = document.getElementById('error');
      const submitBtn = document.getElementById('submitBtn');

      // Reset visuel
      errorEl.classList.add('hidden');
      errorEl.textContent = '';
      submitBtn.disabled = true;
      submitBtn.textContent = 'Inscription en cours...';

      // 1. Récupération des valeurs (Mise à jour pour inclure les nouveaux champs)
      const formData = {
        raisonSociale: document.getElementById('raisonSociale').value.trim(),
        siret: document.getElementById('siret').value.trim(),
        siteWeb: document.getElementById('siteWeb').value.trim(),
        adresse: document.getElementById('adresse').value.trim(),
        ville: document.getElementById('ville').value.trim(),
        pays: document.getElementById('pays').value,
        contactNom: document.getElementById('contactNom').value.trim(),
        email: document.getElementById('email').value.trim(),
        password: document.getElementById('password').value,
        passwordConfirm: document.getElementById('passwordConfirm').value
      };

      // 2. Validation Côté Client
      if (!formData.raisonSociale || !formData.email || !formData.password || 
          !formData.siret || !formData.adresse || !formData.ville || 
          !formData.pays || !formData.contactNom) {
        
        showError('Veuillez remplir tous les champs obligatoires (*)');
        return;
      }

      if (formData.password !== formData.passwordConfirm) {
        showError('Les mots de passe ne correspondent pas');
        return;
      }

      if (formData.password.length < 6) {
        showError('Le mot de passe doit contenir au moins 6 caractères');
        return;
      }

      try {
        // 3. Envoi au Backend
        const res = await fetch('/api/auth/register-entreprise', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData) // On envoie l'objet complet
        });

        const result = await res.json();
        
        if (!res.ok) {
          throw new Error(result.error || 'Erreur lors de l\'inscription');
        }

        // Succès
        window.location.href = '/login?success=Compte créé avec succès ! Connectez-vous.';
        
      } catch (err) {
        showError(err.message);
      }

      // Fonction utilitaire pour afficher l'erreur
      function showError(msg) {
        errorEl.textContent = msg;
        errorEl.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Finaliser l\'inscription';
      }
    });
  </script>
</body>

</html>
